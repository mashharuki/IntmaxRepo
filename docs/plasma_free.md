# Plasma Free に関するメモ

以下は、[Plasma Free についての X の投稿](https://twitter.com/intmaxIO/status/1817115708536541388)の投稿を翻訳したもの

Plsama Free は初の EVM 互換の Plasma プロトコル

革新的な Layer 2 zkRollup を開発し、ステートレスアーキテクチャを使用して、ブロックチェーンアプリケーションに対して非常に効率的で安全かつスケーラブルなソリューションを提供する INTMAX プロジェクトは、Settle Network と Latamex の共同創設者が、初の EVM 互換の Plasma プロトコルである Plasma Free のオープンソース開発を主導することを発表しました。

Plasma Free は、ブロックチェーンアプリケーションのプログラマビリティと柔軟性を向上させ、世界中の開発者の増大するニーズに応えます。

この開発を主導するのは、Y-Combinator の卒業生である@jacksaracco です。Jack は以前に@Latamex_ok と Settle Network を立ち上げました。Latamex はラテンアメリカ初で最大の法定通貨ゲートウェイであり、地域通貨を使用して数百万人が暗号通貨にアクセスできるようにしています。一方、Settle Network は、効率的な取引と国境を越えた支払いを促進する強力なデジタル資産決済フレームワークで知られています。
私たちは、暗号エコシステム内で広範な経験と幅広いネットワークを持つチームを誇りに思います。彼らの暗号関連ビジネス、ウォレット、取引所、DApps における専門知識とつながりは、この革新的なプロジェクトをリードする上で非常に貴重です。

@HiokiLeona、INTMAX の共同創設者兼 CEO。
Plasma は、2017 年に Joseph Poon と Vitalik Buterin によって概念化された、かつて注目された Ethereum の Layer-2 スケーリングソリューションで、Ethereum に Visa レベルの取引量をもたらすことを目指していました。Plasma ネットワークは、預金、引き出し、Merkle ルートを除くすべてのデータと計算をオフチェーンに保持することができます。これにより、オンチェーンのデータ可用性によってボトルネックになることなく非常に大きなスケーラビリティの向上が可能となります。

Plasma はユーザー体験やオンライン要件の問題によりロールアップによって取って代わられましたが、Vitalik Buterin は「Exit games for EVM validiums: the return of Plasma」というブログ記事で Plasma を復活させたいと考えています。Intmax は Plasma と zkRollups の強みを組み合わせて、セキュリティとスケーラビリティを向上させながら、無比のプライバシーを持って取引を処理します。

Plasma Free は、EVM 互換性を維持しながらサイドチェーン上で高速な取引処理を可能にします。これにより、ブロックチェーンアプリケーションのプログラマビリティが向上し、複雑なスマートコントラクトの相互作用をサポートし、取引のセキュリティを確保します。開発者は、Plasma Free サイドチェーンにスマートコントラクトや DApps を簡単にデプロイでき、他のチェーンと比較して高速化と取引手数料の削減の恩恵を受けることができます。

Plasma Free は、日常のユーザーや Web3 開発者のための実際のユースケースを構築する最大のエコシステムとなるでしょう。Plasma は、ハイパースケーリング技術を導入することでマスアダプションを達成する技術です。

Jack Saracco、Plasma Free の創設者。
Plasma Free チームをサポートすることで、INTMAX は開発者エコシステムの成長を促進するだけでなく、より広範なブロックチェーンコミュニティにも貢献します。このイニシアティブは、イノベーション、オープンソース開発、金融の民主化へのコミットメントを強調し、よりアクセスしやすく効率的な分散型金融の景観への重要な一歩を示しています。

INTMAX はまた、エコシステムのサポートを開始し、その最初のリソースを Plasma Free に向けています。INTMAX は、ステートレスアーキテクチャを活用するプロジェクトを引き続きサポートし、助成金の配布、教育イベントの開催、開発者をエコシステムにサポートしオンボードするためのコンテンツの作成を行います。

以下は、[Exit games for EVM validiums: the return of Plasma](https://vitalik.eth.limo/general/2023/11/14/neoplasma.html)の翻訳

EVM バリディウムのための Exit ゲーム：Plasma の復活

Plasma は、預金、引き出し、Merkle ルートを除くすべてのデータと計算をオフチェーンに保持することで、ブロックチェーンのスケーラビリティを大幅に向上させるソリューションの一種です。これにより、オンチェーンデータの可用性によってボトルネックにならない大規模なスケーラビリティの向上が可能となります。Plasma は 2017 年に初めて発明され、2018 年には Minimal Viable Plasma、Plasma Cash、Plasma Cashflow、Plasma Prime など多くのバリエーションが登場しました。しかし、Plasma はその後、大部分がロールアップに取って代わられました。その主な理由は、（i）クライアント側のデータストレージコストが大きいこと、（ii）Plasma の基本的な制約により、支払い以外の用途に一般化することが難しいことにあります。

有効性証明（ZK-SNARKs）の登場により、この決定を再考する理由が生まれました。Plasma を支払いに適用する際の最大の課題であるクライアント側のデータストレージは、有効性証明を用いることで効率的に対処できます。さらに、有効性証明は、EVM を実行する Plasma ライクなチェーンを作成するための多様なツールを提供します。Plasma のセキュリティ保証はすべてのユーザーをカバーするわけではありませんが、それでも多くの資産を実際に安全に保つことができます。

この投稿では、Plasma のアイデアをどのように拡張してそのようなことを実現するかを説明します。

概要：Plasma の仕組み
最も理解しやすい Plasma のバージョンは Plasma Cash です。Plasma Cash は、各コインを個別の NFT として扱い、それぞれのコインの履歴を追跡します。Plasma チェーンにはオペレーターがおり、ブロックを作成し定期的に公開する責任があります。各ブロック内のトランザクションはスパース Merkle ツリーとして保存されます。もしトランザクションがコイン k の所有権を移転する場合、それはツリーの位置 k に表示されます。Plasma チェーンオペレーターが新しいブロックを作成すると、Merkle ツリーのルートをチェーンに公開し、ユーザーにそのユーザーが所有するコインに対応する Merkle ブランチを直接送ります。

以下のような 3 つのトランザクションツリーがあるとします。これにより、全ての過去のツリーが有効であると仮定すると、現在 Eve はコイン 1 を所有し、David はコイン 4、George はコイン 6 を所有していることがわかります。

どの Plasma システムにおいても、主なリスクはオペレーターの不正行為です。これは 2 つの方法で発生する可能性があります：

無効なブロックの公開（例：オペレーターが Fred がその時点でコインを所有していないにもかかわらず、コイン 1 を Fred から Hermione に送るトランザクションを含める）
利用不可能なブロックの公開（例：オペレーターが Bob にブロックの Merkle ブランチを送らず、Bob がそのコインがまだ有効で未使用であることを他人に証明できなくする）
オペレーターがユーザーの資産に関係する形で不正行為を行った場合、ユーザーは直ちに（具体的には 7 日以内に）退出する責任があります。ユーザー（「エクジッター」）が退出するとき、前の所有者から自分にそのコインを移転したトランザクションの含有を証明する Merkle ブランチを提供します。これにより 7 日間のチャレンジ期間が始まり、その期間中に他のユーザーは以下の 3 つのいずれかを証明する Merkle 証明を提供することでその退出をチャレンジできます：

最新の所有者ではない：エクジッターがコインを他人に移転した後のトランザクション
二重支払い：前の所有者から他の誰かにコインを移転したトランザクションが、エクジッターに移転するトランザクションの前に含まれている
無効な履歴：過去 7 日間以内にトランザクションがあり、対応する支出がない。エクジッターは対応する支出を提供することで応答できますが、提供しない場合は退出が失敗します。
これらのルールにより、コイン k を所有するユーザーは、実際にコイン k を所有し退出できることを確認するために、過去 1 週間の全ての履歴ツリーの位置 k の Merkle ブランチを確認する必要があります。また、資産の移転を含む全てのブランチを保存し、チャレンジに応答し安全に退出できるようにする必要があります。

代替トークンへの一般化
上記の設計は NFT に適しています。しかし、NFT よりもはるかに一般的なのは、ETH や USDC のような代替可能なトークンです。Plasma Cash を代替可能なトークンに適用する一つの方法は、コインの小額単位（例：0.01 ETH）を個別の NFT として扱うことです。残念ながら、この方法では退出のガスコストが高くなりすぎます。

一つの解決策は、多くの隣接するコインを単一のユニットとして扱い、一度に転送または退出できるように最適化することです。これには 2 つの方法があります：

Plasma Cash をほぼそのまま使用し、多くの隣接するオブジェクトが同じ場合に非常に迅速に Merkle ツリーを計算する高度なアルゴリズムを使用する。これは意外と簡単であり、Python 実装も存在します。
多くの隣接するコインを単一のオブジェクトとして表す Plasma Cashflow を使用する。
しかし、これらのアプローチはどちらも断片化の問題に直面します。例えば、コーヒーを購入するために数百人からそれぞれ 0.001 ETH を受け取った場合、ツリーの多くの場所に 0.001 ETH が存在することになり、実際にその ETH を退出するには多くの別々の退出を提出する必要があり、ガス料金が過剰になります。デフラグメントプロトコルが開発されていますが、実装は難しいです。

また、システムを再設計し、より伝統的な「未使用トランザクション出力」（UTXO）モデルを考慮することもできます。コインを退出するときには、そのコインの過去 1 週間の履歴を提供し、誰でもその履歴のコインが既に退出されていることを証明することで退出をチャレンジできます。

右下の 0.2 ETH UTXO の引き出しは、その履歴にあるいずれかの UTXO の引き出しを示すことでキャンセルできます。特に、左中央および左下の UTXO は祖先ですが、左上の UTXO はそうではありません。このアプローチは、2013 年頃のカラードコインプロトコルの注文ベースの着色のアイデアに似ています。

さまざまな技術があります。すべての場合において、目標は異なる時点で「同じコイン」の概念を追跡し、「同じコイン」が二重に引き出されないようにすることです。

EVM への一般化の課題
残念ながら、支払いから EVM への一般化ははるかに難しいです。主要な課題の一つは、EVM の多くの状態オブジェクトには明確な「所有者」がいないことです。Plasma のセキュリティは、各オブジェクトに所有者がいて、その所有者がチェーンのデータが利用可能であることを監視し、何か問題が発生した場合にそのオブジェクトを退出する責任を負うことに依存しています。しかし、多くの Ethereum アプリケーションはこのように機能していません。例えば、Uniswap の流動性プールには単一の所有者がいません。

もう一つの課題は、EVM は依存関係を制限しようとしないことです。ブロック N のアカウント A に保持されている ETH は、ブロック N-1 のどこからでも来ることができます。整合性のある状態を退出するためには、EVM Plasma チェーンは、極端な場合、ブロック N の情報を使用して退出しようとする場合、ブロック N の全状態をオンチェーンに公開するための手数料を支払う必要があります。ガスコストは数百万ドルに達する可能性があります。UTXO ベースの Plasma スキームにはこの問題はありません。各ユーザーは、自分の資産を最新のブロックから退出できます。

さらに、EVM の無限の依存関係は有効性を証明するインセンティブの調整を難しくします。どの状態も他のすべてに依存するため、何か一つを証明するためにはすべてを証明する必要があります。このような状況での失敗を解決することは、データの可用性の問題のため、インセンティブに一致するようにはできません。特に厄介な問題は、所有者の同意なしにオブジェクトの状態が変わらないという UTXO ベースのシステムに存在する保証が失われることです。この保証は非常に有用で、所有者が自分の資産の最新の証明可能な状態を常に把握し、退出ゲームを簡素化することができます。これがないと、退出ゲームの作成が非常に難しくなります。

有効性証明がこれらの問題を軽減する方法
有効性証明が Plasma チェーン設計を改善する最も基本的な方法は、各 Plasma ブロックの有効性をオンチェーンで証明することです。これにより設計空間が大幅に簡素化されます。オペレーターからの攻撃について心配する必要があるのは、無効なブロックではなく利用不可なブロックだけになります。Plasma Cash の場合、履歴チャレンジについて心配する必要がなくなります。これにより、ユーザーがダウンロードする必要のある状態は、過去 1 週間の各ブロックごとの 1 ブランチから、各資産ごとの 1 ブランチに減少します。

さらに、最新の状態からの引き出し（通常の場合、オペレーターが正直である場合、すべての引き出しは最新の状態から行われます）は、最新の所有者でないチャレンジの対象にはなりません。そのため、有効性証明された Plasma チェーンでは、そのような引き出しは一切のチャレンジの対象にはなりません。つまり、通常の場合、引き出しは即座に行うことができます。

EVM への拡張：並列 UTXO グラフ
EVM の場合、有効性証明を使用すると、ETH および ERC20 トークンの並列 UTXO グラフを実装し、UTXO グラフと EVM 状態の同等性を SNARK で証明することができます。一度これができれば、UTXO グラフ上に「通常の」Plasma システムを実装できます。

これにより、EVM の多くの複雑さを回避できます。例えば、アカウントベースのシステムでは、誰かが同意なしにアカウントを編集（コインを送り、残高を増やす）できるという事実は、Plasma 構築が EVM 状態自体ではなく、EVM と並行する UTXO 状態に基づいているため問題になりません。この場合、受け取ったコインは別個のオブジェクトになります。

EVM への拡張：総状態退出
「Plasma EVM」を作成するためのより単純なスキームも提案されています。例えば、Plasma Free や、以前の 2019 年の投稿があります。これらのスキームでは、誰でも L1 にメッセージを送信し、オペレーターにトランザクションを含めるか、特定の状態のブランチを利用可能にするよう強制することができます。オペレーターがこれを行わない場合、チェーンはブロックを逆戻しし始めます。チェーンは、誰かが全状態のコピー、またはユーザーが潜在的に欠落しているとフラグを立てたデータのすべてを投稿するまで、逆戻しを続けます。引き出しには賞金を設定することができ、これにより、そのユーザーのガスコストのシェアを支払うことができます。

このようなスキームには、最新の状態をチェーンが逆戻しする可能性が常にあるため、通常の場合でも即時引き出しを許可しないという弱点があります。

EVM プラズマスキームの限界
このようなスキームは強力ですが、すべてのユーザーに完全なセキュリティ保証を提供することはできません。最も明確に失敗するケースは、特定の状態オブジェクトに明確な経済的「所有者」がいない状況です。

例として、CDP（担保付き債務ポジション）のケースを考えてみましょう。CDP は、ユーザーがコインをロックし、債務を支払った場合にのみ解放できるスマートコントラクトです。ユーザーが CDP に 1 ETH（この記事を書いている時点で約 2000 ドル）をロックし、1000 DAI の債務があるとします。Plasma チェーンがブロックの公開を停止し、ユーザーが退出を拒否します。この場合、ユーザーは退出しないで済むことになります。ユーザーは、ETH の価格が 1000 ドル未満に下がった場合、CDP を放棄し、価格が 1000 ドル以上にとどまる場合は最終的にそれを請求します。このような悪意のあるユーザーは、平均してこれによって利益を得ることになります。

もう一つの例として、プライバシーシステム（例：Tornado Cash や Privacy Pools）があります。以下のように 5 人の預金者がいるプライバシーシステムを考えてみましょう：

プライバシーシステムの ZK-SNARK は、システムに入るコインの所有者とシステムから出るコインの所有者のリンクを隠します。

オレンジのみが引き出したと仮定し、その時点で Plasma チェーンオペレーターがデータの公開を停止します。また、UTXO グラフアプローチを使用し、先入れ先出しルールを適用すると、各コインが直下のコインと一致することになります。この場合、オレンジは事前混合および事後混合のコインを引き出すことができ、システムはこれを 2 つの別個のコインとして認識します。ブルーが事前混合のコインを引き出そうとすると、オレンジのより新しい状態がそれを超えることになります。一方、ブルーは事後混合のコインを引き出すための情報を持っていません。

これを修正するためには、他の 4 人の預金者がプライバシーコントラクト自体を引き出し、L1 でコインを取り出せるようにする必要があります。しかし、そのようなメカニズムを実装するには、プライバシーシステムの開発者の追加の努力が必要です。

他のプライバシー解決策（例：Intmax アプローチ）もあります。これは、Plasma ライクなオペレーターとともにチェーンロールアップスタイルで数バイトをオンチェーンに置くことです。

Uniswap LP ポジションにも同様の問題があります。例えば、Uniswap ポジションで USDC を ETH に交換した場合、事前取引の USDC と事後取引の ETH を引き出そうとすることができます。Plasma チェーンオペレーターと共謀すると、流動性プロバイダーや他のユーザーは事後取引の状態にアクセスできなくなるため、事後取引の USDC を引き出すことができません。このような状況を防ぐためには、特別なロジックが必要です。

結論
2023 年現在、Plasma は過小評価された設計空間です。ロールアップは引き続き金の基準であり、セキュリティプロパティは無比です。開発者体験の観点から特にそうです。アプリケーション開発者が所有権グラフやアプリケーション内のインセンティブフローについて考える必要がないというシンプルさに匹敵するものはありません。

しかし、Plasma を使用するとデータの可用性の問題を完全に回避でき、取引手数料が大幅に削減されます。Plasma は、本来 validiums であるチェーンにとって重要なセキュリティ向上をもたらすことができます。ZK-EVM が今年ついに実現することにより、この設計空間を再探索し、開発者体験を簡素化し、ユーザーの資金を保護するためのより効果的な構築方法を考案する絶好の機会が生まれました。

Plasma は通常の ZK ロールアップとは全く別のアプローチであり、これまでは複雑な処理に向かないとされてきた。

そこに一つの解を出そうとしているのが、INTMAX チームがやろうとしている Plasma Free !!
